<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Órbita Trocoidal da Lua</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #020617 0%, #000 60%, #020617 100%);
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #e5e7eb;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="orbitCanvas"></canvas>

  <script>
    // =========================
    // Configurações principais
    // =========================
    const config = {
      earthOrbitRadius: 220,        // raio da órbita da Terra em relação ao Sol
      moonOrbitRadius: 70,          // raio da órbita da Lua em relação à Terra
      earthAngularSpeed: 0.002,     // velocidade angular da Terra
      moonAngularSpeed: 0.02,       // velocidade angular da Lua (mais rápida)
      moonTrailMaxPoints: 3000,     // quantidade de pontos da trilha da Lua
      starCount: 200,               // quantidade de estrelas no fundo
      lineWidthOrbits: 1.2,
      lineWidthTrail: 1.8
    };

    const canvas = document.getElementById("orbitCanvas");
    const ctx = canvas.getContext("2d");

    let width, height, centerX, centerY;

    let time = 0;
    let stars = [];
    let moonTrail = [];

    // =========================
    // Redimensionamento
    // =========================
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
      centerX = width / 2;
      centerY = height / 2;
      generateStars();
    }

    window.addEventListener("resize", resize);
    resize();

    // =========================
    // Estrelas de fundo
    // =========================
    function generateStars() {
      stars = [];
      for (let i = 0; i < config.starCount; i++) {
        stars.push({
          x: Math.random() * width,
          y: Math.random() * height,
          r: Math.random() * 1.1,
          alpha: 0.2 + Math.random() * 0.8
        });
      }
    }

    function drawBackground() {
      // Fundo já é escuro via CSS, aqui só desenhamos as estrelas
      ctx.save();
      ctx.fillStyle = "white";
      for (const s of stars) {
        ctx.globalAlpha = s.alpha;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();
      ctx.globalAlpha = 1;
    }

    // =========================
    // Sol
    // =========================
    function drawSun() {
      const radius = 40;

      ctx.save();
      // Glow externo
      const gradient = ctx.createRadialGradient(
        centerX, centerY, 0,
        centerX, centerY, radius * 4
      );
      gradient.addColorStop(0, "rgba(255, 255, 255, 0.95)");
      gradient.addColorStop(0.2, "rgba(190, 235, 255, 0.9)");
      gradient.addColorStop(1, "rgba(15, 23, 42, 0)");

      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius * 4, 0, Math.PI * 2);
      ctx.fill();

      // Disco central
      ctx.shadowBlur = 25;
      ctx.shadowColor = "#e0f2fe";
      ctx.fillStyle = "#f9fafb";
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    // =========================
    // Órbita da Terra
    // =========================
    function drawEarthOrbit() {
      ctx.save();
      ctx.lineWidth = config.lineWidthOrbits;
      ctx.strokeStyle = "#38bdf8";
      ctx.globalAlpha = 0.4;
      ctx.beginPath();
      ctx.arc(centerX, centerY, config.earthOrbitRadius, 0, Math.PI * 2);
      ctx.stroke();
      ctx.restore();
    }

    // =========================
    // Cálculos de posições
    // =========================
    function getEarthPosition(t) {
      const angleE = t * config.earthAngularSpeed;
      const x = centerX + config.earthOrbitRadius * Math.cos(angleE);
      const y = centerY + config.earthOrbitRadius * Math.sin(angleE);
      return { x, y, angleE };
    }

    function getMoonPosition(t, earthPos) {
      const angleM = t * config.moonAngularSpeed;
      const x = earthPos.x + config.moonOrbitRadius * Math.cos(angleM);
      const y = earthPos.y + config.moonOrbitRadius * Math.sin(angleM);
      return { x, y, angleM };
    }

    // =========================
    // Trilha trocoidal da Lua
    // =========================
    function updateMoonTrail(moonPos) {
      moonTrail.push({ x: moonPos.x, y: moonPos.y });
      if (moonTrail.length > config.moonTrailMaxPoints) {
        moonTrail.shift();
      }
    }

    function drawMoonTrail() {
      if (moonTrail.length < 2) return;

      ctx.save();
      ctx.lineWidth = config.lineWidthTrail;
      ctx.strokeStyle = "#7dd3fc";
      ctx.globalAlpha = 0.8;
      ctx.beginPath();

      for (let i = 0; i < moonTrail.length; i++) {
        const p = moonTrail[i];
        if (i === 0) {
          ctx.moveTo(p.x, p.y);
        } else {
          ctx.lineTo(p.x, p.y);
        }
      }

      ctx.stroke();
      ctx.restore();
    }

    // =========================
    // Terra e Lua
    // =========================
    function drawEarthAndMoon(earthPos, moonPos) {
      ctx.save();

      // Órbita pequena da Lua ao redor da Terra (só um círculo guia)
      ctx.lineWidth = 0.8;
      ctx.strokeStyle = "rgba(125, 211, 252, 0.35)";
      ctx.beginPath();
      ctx.arc(earthPos.x, earthPos.y, config.moonOrbitRadius, 0, Math.PI * 2);
      ctx.stroke();

      // Terra
      ctx.shadowBlur = 10;
      ctx.shadowColor = "#38bdf8";
      ctx.fillStyle = "#0ea5e9";
      ctx.beginPath();
      ctx.arc(earthPos.x, earthPos.y, 10, 0, Math.PI * 2);
      ctx.fill();

      // Rótulo Earth
      ctx.shadowBlur = 0;
      ctx.fillStyle = "#e5e7eb";
      ctx.font = "14px system-ui, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText("Earth", earthPos.x, earthPos.y - 14);

      // Lua
      ctx.shadowBlur = 12;
      ctx.shadowColor = "#bae6fd";
      ctx.fillStyle = "#e0f2fe";
      ctx.beginPath();
      ctx.arc(moonPos.x, moonPos.y, 6, 0, Math.PI * 2);
      ctx.fill();

      // Rótulo Moon
      ctx.shadowBlur = 0;
      ctx.fillStyle = "#e5e7eb";
      ctx.font = "14px system-ui, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText("Moon", moonPos.x, moonPos.y - 18);

      ctx.restore();
    }

    // =========================
    // Anel ondulado "completo"
    // (opcional – aparência da imagem)
    // =========================
    function drawStaticWaveRing() {
      // Desenha uma "onda" em torno do Sol, só estética,
      // para se aproximar mais da imagem de referência.
      const baseRadius = config.earthOrbitRadius + 40;
      const waveAmplitude = 20;
      const waveFrequency = 16; // quantas ondas em torno do círculo

      ctx.save();
      ctx.lineWidth = 1.2;
      ctx.strokeStyle = "rgba(125, 211, 252, 0.6)";
      ctx.beginPath();

      const steps = 720;
      for (let i = 0; i <= steps; i++) {
        const theta = (i / steps) * Math.PI * 2;
        const offset = Math.sin(theta * waveFrequency) * waveAmplitude;
        const r = baseRadius + offset;
        const x = centerX + r * Math.cos(theta);
        const y = centerY + r * Math.sin(theta);

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }

      ctx.stroke();
      ctx.restore();
    }

    // =========================
    // Loop de animação
    // =========================
    function animate() {
      time++;

      ctx.clearRect(0, 0, width, height);

      drawBackground();
      drawSun();
      drawEarthOrbit();
      drawStaticWaveRing();

      const earthPos = getEarthPosition(time);
      const moonPos = getMoonPosition(time, earthPos);

      updateMoonTrail(moonPos);
      drawMoonTrail();
      drawEarthAndMoon(earthPos, moonPos);

      requestAnimationFrame(animate);
    }

    // Inicia a dança orbital
    animate();
  </script>
</body>
</html>
